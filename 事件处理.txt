考虑事件处理

1､数据表定义

系统事件定义表（与事件检测的事件一一对应）
id
event_code
event_name
系统内置，不提供界面编辑


预案定义表（plan)
plan_id
plan_code   预案编号（可用YA-201801,也可保留随便添)
plan_name   名称
plan_desc   描述
plan_enable 1-启用  0-停用
plan_beginpos    预案针对起始位置。 采用公里.米的方式。 如K102+44 = 102.44。 0表示所有。
plan_endpos      预案针对终止位置。 0表示所有
plan_pos         1-上行 2-下行 0-通用。
event_code  对应事件编号
plan_user   输入人员
plan_at     建立日期时间

预案支持具体的一个区域，或通用区域。



预案执行通知单位(plan_notify)
id
plan_id    预案ID
pn_order   执行步骤 与 设备动作 联合排序（JOSN发送两个，前端处理）
pn_notify  单位或人员
pn_phone   电话
pn_message 通告内容


预案执行设备动作（plan_action)
id
plan_id       预案ID
pa_order      执行步骤。与 通知单位 联合排序
pa_devtype    设备类型。  涉及：风机、照明、情报板、车道指示标志、交通信号灯、卷帘门、有线广播（每个设备单独一个界面）
              针对照明可以按照明模式进行控制。即 照明棋块具有模式控制命令。
              范围：事件所在隧洞、
              风机在火灾情况下，须现场调度人员指挥进行操作。在交通情况下可以控制。
              风机控制可以按隧道内风机组、启动比例（全部、3/4､一半、1/4)：控制正转、反转。 
              范围：事件点前方、事件点后方。
              车道指示器：上行、下行、禁行，位置：行车道、超车道、紧急停车带，
              事件点前：本隧道内，前方封闭区域
              事件点后：本隧道内，后方封闭区域
              交通信号灯：红、绿、黄、转向（转向一般用于隧道口有向对向的通道，适用于对端隧道封闭时，车辆驶回）
              位置：同车道指标标志
              情报板：这个东西最多。系统对不同情报板按类型进行了区分。因此，制作时按情报板类型分别进行。
              1､悬挂、门架、悬臂
              2､按事件点前方、事件所在封闭路段前、事件点后。暂按这三个区域设置。单独设置各自的动作。
              卷帘门，事件点前、事件点后，动作：卷帘门打开。
              有线广播需与有线广播联动（在有线广播上设置与事件相关的录音，并在事件发生时可启动，与有线广播系统必须同步设置）
pa_scope.     范围。1-指定设备列表。2-事件所在隧道洞。3-事件所在隧道。4-事件点前本隧道内。5-事件点前方封闭区域。6-事件后本隧道内 7-事件点后方封闭区域。
pa_action     设备动作JSON
pa_desc       设备动作文字描述
pa_devs       指定的设备编号列表


封闭区域 包括：事件前方是否可驶离高速公路，事件前方是否可进入高速公路
封闭区域的定义？服务区算什么？？



1､ 常：车行横洞位置是如何定义的？重点在借道疏散。
2､ 页面分为2个，通知和执行动作
3､ 考虑后台实现图形的处理，双击事件、请求实时个数
4､ 考虑将控制和采集方式全部改为POST方式，以有效的实现通用性。
   重点考虑执行时，执行时，发送控制命令。
5､ 事件点的摄像机自动切换，也是应急模块的一部分。（重点：与平台的对接，提高显示速度）
6､ 考虑封闭路段的表示。
7､ 预案完成时，事件模块自动记录各个被控制设备的动作，提示是否进行恢复，恢复则自动完成将原设备动作恢复。


预案执行记录表(plan_history)
id
plan_uuid.  表示同一个执行。
plan_id
plan_at
plan_user
plan_order
plan_memo 以文本方式记录所有的内容。如通知谁，对方的人员，说了些什么，
          对于设备动作，显示那些设备，执行了什么动作。


交通量判断模块：针对各个封闭区间进行判断，以入出的数量。？？？？


系统事件表（与预案有关系）


各个模块的处理：
   应急模块，检测系统的事件，如发现事件，则弹出窗口。

   应急模块，








界面如何：

当前界面显示内容










	